import{c as f,u as U,r as d,g as D,e as q,f as M,j as e,T as p,X as F,h as Y,i as W,k as G}from"./index-CA2xEXh_.js";import{C as V}from"./circle-check-big-Czp4HeX4.js";import{Z}from"./zap-L-fdDti7.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["path",{d:"M5 12h14",key:"1ays0h"}]],X=f("minus",H);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=[["path",{d:"M15 21v-5a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v5",key:"slp6dd"}],["path",{d:"M17.774 10.31a1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.451 0 1.12 1.12 0 0 0-1.548 0 2.5 2.5 0 0 1-3.452 0 1.12 1.12 0 0 0-1.549 0 2.5 2.5 0 0 1-3.77-3.248l2.889-4.184A2 2 0 0 1 7 2h10a2 2 0 0 1 1.653.873l2.895 4.192a2.5 2.5 0 0 1-3.774 3.244",key:"o0xfot"}],["path",{d:"M4 10.95V19a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8.05",key:"wn3emo"}]],K=f("store",J);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],ee=f("trending-down",Q),ae=({isOpen:B,onClose:v,onShowToast:c,onWatchAd:E})=>{var S;const{user:n,inventory:h,activeBuffs:o,sellAll:L,buyShopItem:$,slots:m}=U(),[x,j]=d.useState("SELL"),[b,y]=d.useState("PERMANENT"),[A,T]=d.useState(null),N=d.useMemo(()=>m.filter(t=>t.isPurchased).map(t=>t.id),[m]),_=d.useMemo(()=>D(n.plan,N),[n.plan,N]),a=(o.PRICE_BOOSTER||0)>Date.now(),u=(o.TRADE_PERMIT||0)>Date.now(),w=Math.round((((S=q[n.plan])==null?void 0:S.bonus)||0)*100),k=d.useMemo(()=>{let t=0,s={};return Object.values(h).forEach(r=>{const{totalPrice:l,breakdown:i}=M(r.cropName,r.quantity,n.plan,o);t+=l,s[r.cropName]={quantity:r.quantity,price:i.basePrice,total:l}}),{total:t,breakdown:s}},[h,n.plan,o]),I=t=>{const{price:s,trend:r,changePercent:l}=G(t);return{price:s,trend:r,change:Math.abs(l)}},O=()=>{const t=L();t>0?(c(`Sold all for ${t.toLocaleString()} PTS!`,"success"),navigator.vibrate&&navigator.vibrate([100])):c("Nothing to sell!","info")},z=t=>{if(t.id==="plot_2"||t.id==="plot_3"){const s=m.find(r=>r.id===t.slotId);if(s!=null&&s.isPurchased){c("Already Owned!","info");return}}if(n.balance<t.cost){c("Insufficient Funds","info");return}confirm(`Buy ${t.name} for ${t.cost.toLocaleString()} PTS?`)&&($(t.id)?(c(`Bought ${t.name}!`,"success"),navigator.vibrate&&navigator.vibrate(50)):c("Purchase Failed","info"))},R=({trend:t})=>{switch(t){case"UP":return e.jsx(p,{size:14,className:"text-green-500"});case"DOWN":return e.jsx(ee,{size:14,className:"text-red-500"});default:return e.jsx(X,{size:14,className:"text-gray-400"})}};return B?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-md",onClick:v}),e.jsxs("div",{className:"relative w-full max-w-md bg-white border-4 border-gray-300 rounded-3xl shadow-2xl overflow-hidden backdrop-blur-xl animate-in fade-in zoom-in-95 duration-200 flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center p-4 bg-gradient-to-r from-green-500 to-emerald-600 border-b-4 border-green-700",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("h2",{className:"text-xl font-black tracking-widest uppercase text-white drop-shadow-sm flex items-center gap-2",children:[e.jsx(p,{size:24})," Market"]})}),e.jsx("button",{onClick:v,className:"bg-black/20 p-2 rounded-full hover:bg-black/40 text-white transition-colors",children:e.jsx(F,{size:20})})]}),e.jsxs("div",{className:"flex bg-gray-100 border-b border-gray-300",children:[e.jsxs("button",{onClick:()=>j("SELL"),className:`flex-1 py-4 font-black uppercase tracking-wider flex items-center justify-center gap-2 ${x==="SELL"?"bg-white text-green-600 border-b-4 border-green-500":"text-gray-400 hover:bg-gray-200"}`,children:[e.jsx(p,{size:20})," Sell"]}),e.jsxs("button",{onClick:()=>j("BUY"),className:`flex-1 py-4 font-black uppercase tracking-wider flex items-center justify-center gap-2 ${x==="BUY"?"bg-white text-blue-600 border-b-4 border-blue-500":"text-gray-400 hover:bg-gray-200"}`,children:[e.jsx(K,{size:20})," Shop"]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-hide bg-gray-50 p-4",children:[x==="SELL"&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"bg-gray-900 rounded-xl p-4 border border-gray-700",children:e.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-400 uppercase",children:"Plan"}),e.jsxs("div",{className:"text-sm font-black text-amber-400",children:["+",w,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-400 uppercase",children:"Trade"}),e.jsx("div",{className:`text-sm font-bold ${u?"text-green-400":"text-gray-500"}`,children:u?"+10%":"0%"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-400 uppercase",children:"Booster"}),e.jsx("div",{className:`text-sm font-bold ${a?"text-green-400":"text-gray-500"}`,children:a?"+15%":"0%"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[10px] text-gray-400 uppercase",children:"Total"}),e.jsxs("div",{className:"text-sm font-black text-green-400",children:["+",w+(u?10:0)+(a?15:0),"%"]})]})]})}),e.jsxs("button",{onClick:()=>!a&&E(),disabled:a,className:`w-full p-4 rounded-xl flex items-center justify-between shadow-md relative overflow-hidden ${a?"bg-gray-800":"bg-gradient-to-r from-yellow-400 to-amber-500"}`,children:[e.jsxs("div",{className:"relative z-10 text-left",children:[e.jsx("div",{className:`font-black uppercase text-lg ${a?"text-gray-400":"text-white drop-shadow-md"}`,children:a?"Booster Active":"Boost Prices"}),e.jsx("div",{className:`text-xs font-bold ${a?"text-green-400":"text-yellow-100"}`,children:a?"+15% Bonus Applied":"Watch Ad for +15% Sell Bonus"})]}),e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${a?"bg-gray-700 text-green-500":"bg-white/20 text-white"}`,children:a?e.jsx(V,{size:24}):e.jsx(Z,{size:24,className:"fill-white"})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm",children:[e.jsxs("div",{className:"grid grid-cols-5 bg-gray-100 p-2 text-[10px] font-bold text-gray-500 uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-2 pl-2",children:"Item"}),e.jsx("div",{className:"text-center",children:"Owned"}),e.jsx("div",{className:"text-center",children:"Trend"}),e.jsx("div",{className:"text-right pr-2",children:"Price"})]}),Y.map(t=>{const{trend:s,change:r}=I(t.name),l=h[t.name],i=l?l.quantity:0,P=A===t.name,{breakdown:g}=M(t.name,i,n.plan,o),C=g.basePrice*(1+g.trendMod)*(1+g.planBonus/100+g.tradePermit/100+g.booster/100);return e.jsxs("div",{onClick:()=>T(P?null:t.name),className:`grid grid-cols-5 p-3 border-b border-gray-100 items-center cursor-pointer transition-colors ${P?"bg-amber-50":"hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"col-span-2 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-xl",style:{backgroundColor:t.color+"20",color:t.color},children:"ðŸŒ½"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-gray-800",children:t.name}),e.jsxs("div",{className:"text-[10px] text-gray-400",children:["Base: ",t.sellPrice]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("span",{className:`text-sm font-bold ${i>0?"text-green-600":"text-gray-400"}`,children:i})}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(R,{trend:s}),e.jsx("span",{className:`text-[10px] font-bold ${s==="UP"?"text-green-500":s==="DOWN"?"text-red-500":"text-gray-400"}`,children:s==="STABLE"?"-":`+${Math.round(r*100)}%`})]})}),e.jsxs("div",{className:"text-right pr-2",children:[e.jsx("div",{className:"text-sm font-black text-gray-700",children:Math.round(C).toLocaleString()}),i>0&&e.jsxs("div",{className:"text-[10px] text-green-600 font-bold",children:["=",Math.round(C*i).toLocaleString()]})]})]},t.name)})]})]}),x==="BUY"&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y("PERMANENT"),className:`px-3 py-1.5 rounded-full text-xs font-bold transition-all ${b==="PERMANENT"?"bg-blue-500 text-white":"bg-gray-200 text-gray-500 hover:bg-gray-300"}`,children:"Permanent"}),e.jsx("button",{onClick:()=>y("CONSUMABLE"),className:`px-3 py-1.5 rounded-full text-xs font-bold transition-all ${b==="CONSUMABLE"?"bg-purple-500 text-white":"bg-gray-200 text-gray-500 hover:bg-gray-300"}`,children:"Consumables"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:_.filter(t=>t.type===b).map(t=>{var l;const s=t.slotId&&((l=m.find(i=>i.id===t.slotId))==null?void 0:l.isPurchased)||t.id==="yield_boost"&&n.hasYieldBooster,r=n.balance>=t.cost;return e.jsx("div",{className:`bg-white rounded-xl p-3 shadow-sm border transition-all ${s?"border-gray-200 opacity-60":r?"border-green-200 hover:border-green-400":"border-red-200"}`,children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:"text-4xl mb-2 transform group-hover:scale-110 transition-transform",children:t.icon}),e.jsx("div",{className:"font-bold text-gray-800 text-sm leading-tight mb-1",children:t.name}),e.jsx("div",{className:"text-[10px] text-gray-400 mb-3 h-8 line-clamp-2",children:t.description}),s?e.jsx("div",{className:"w-full py-1.5 bg-gray-100 text-gray-400 font-bold text-xs rounded-lg",children:"Owned"}):e.jsxs("button",{onClick:()=>z(t),disabled:!r,className:`w-full py-1.5 font-bold text-xs rounded-lg shadow-sm active:scale-95 transition-all ${r?"bg-green-500 text-white hover:bg-green-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[t.cost.toLocaleString()," PTS"]})]})},t.id)})})]})]}),x==="SELL"&&e.jsxs("div",{className:"p-4 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 text-xs font-bold text-gray-500",children:[e.jsx("span",{children:"Estimated Total"}),e.jsxs("span",{className:"text-green-600 text-lg",children:[k.total.toLocaleString()," PTS"]})]}),e.jsxs(W,{variant:"green",className:"w-full",onClick:O,disabled:k.total===0,children:["Sell All (",Object.keys(h).length," items)"]})]})]})]}):null};export{ae as MarketModal};
